---
title: 深入JS - 2.Node与WebAPI的区别
tags:
---

JS的宿主环境除了**JS解释器**（如V8）外还有**API实现**、**事件循环**等部分，其中JS解释器部分由ECMA标准委员会负责，不同平台间区别不大；但剩下的部分各个平台则有不同甚至完全独立的实现，标准也不尽相同。

**NodeJS**（含Deno）和**Webkit引擎**（这里泛指浏览器环境，包括Chromium，Gecko等分支）是两大主流的JS宿主环境，本篇文章聚焦于二者在实现上的区别。

## 事件循环（event loop）

关于浏览器事件循环和事件循环的实现细节详见我的[另一篇文章](#)，这里默认读者具备浏览器事件循环的基础知识，就只简要叙述一下**浏览器事件循环**的要点：

- 由于 JavaScript 是**单线程**的，且 JavaScript **主线程和渲染线程互斥**，如果异步操作阻塞 JavaScript
    的执行，会造成浏览器假死。而事件循环为浏览器引入了**任务队列（Callback Queue）**，使得异步任务可以非阻塞地进行，本质上说是 JavaScript 的异步任务调度机制实现。
- 浏览器事件循环将异步任务分为**宏任务（macrotask）**和**微任务（microtask）**两种，在一个事件循环中解释器会**先执行宏任务**（因为在HTML中应先执行`<script>`里的脚本作为入口）；在一个代码块全部执行完毕（执行栈为空且解释器空闲）后事件循环会**优先检索执行队列中的微任务**；在所有微任务都被执行后，解释器会执行**宏任务**，并**回到第一步**。



而 Node 中的 Event Loop 和浏览器中的是完全不相同的东西。Node.js 采用 V8 作为 JS 的解析引擎，而 I/O 处理方面使用了自己设计的 `libuv`，`libuv` 是一个基于事件驱动的跨平台抽象层，封装了不同操作系统一些底层特性，对外提供统一的 API，事件循环机制也是它里面的实现（下文会详细介绍）。



---

## 参考资料

- [javascript - 浏览器与Node的事件循环(Event Loop)有何区别? - Fundebug - SegmentFault 思否](https://segmentfault.com/a/1190000017893482)

