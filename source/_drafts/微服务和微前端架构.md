---
title: 微服务和微前端架构
tags:
---

之前在另一家公司实习的时候就被微服务架构等一系列词汇搞得晕乎乎的，好在最后也没涉及这方面的事情，也就不了了之了。

最近又刷到了这方面的东西，正好现在公司里有一些相关的事情（在架构上），也正好做一个学习了解，捋一捋**微服务（micro-service）**、**微前端（micro-frontend）**还有一个更摸不着头脑的**“无服务”（serverless）**是什么东西。

<!-- more -->

当然，因为最近做的一直是前端开发这方面，我的重心自然会放在微前端上，但由于这是个历史发展的概念，只有理解了微服务的发展历史才能更好地理解为什么需要、如何利用微前端架构进行开发。因此我不会细究微服务的部署，但会尝试微前端的部署过程与实例。

## 微服务

### 软件架构的发展与分类

软件架构分为许多类别，如单体架构、微服务架构、分布式架构等，它们虽有出现的先后顺序之别，但**严格意义上并没有先进与否的区别，只是适用于不同的应用场景**。

比如你一个小的不能再小的应用，非要上分布式或者微服务，那可能就是脱了裤子放屁，可能RPC开销、管理成本、MapReduce开销等等都会超过你任务本身的开销，因此还是应该按需选择最合适的方案。

#### 单体架构

**单体架构**（monolithic software）是一种将所有功能和逻辑写在一个项目（或部署在一个项目/容器）中的写法，一个实例中集成了一个系统的所有功能，并通过负载均衡软件/设备实现多实例调用。

![img](https://picgo-1308055782.cos.ap-chengdu.myqcloud.com/picgo-core/2023/05/20230525005329.png)

如我们熟知的MVC、MVVM架构严格意义上都属于单体架构，它们虽然在业务逻辑（如视图层、View Model和逻辑层）上做了区分，但本质上仍是单体应用。

区别一个单体应用最好用的方法就是：**你对其中某一个功能进行改动，会不会需要重新编译整个项目？需不需要担心耦合造成的蝴蝶效应？**如果会，那就是单体应用。

#### 单体架构发展的后期

最开始的单体架构是所有功能都耦合在一起，甚至前后端不分离，但随着项目体量的不断扩大，单体模式的弊端逐渐显露出来，如：扩展性差、无法实现复杂业务、技术升级困难等。

为了解决上述问题，人们给单体架构打了一些“补丁”，对代码进行拆分来提高维护性：

- 分层开发：如MVC、MVVM等**设计模式**（是的，算设计模式而不是软件架构），将视图层和逻辑层代码分离开来，但还是放在一个项目中
- 业务拆分：按照业务对模块进行拆分，但模块之间如何相联就成了下一个问题（如果分开开发，一起部署就仍是单体架构；如果分开部署到Web上，则成了后文提到的[SOA架构](#面向服务架构)）

![img](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/monolithic-split.png)

### 面向服务架构

**面向服务架构（SOA，Service-Oriented Architecture）**伴随着互联网的兴起而兴起，将功能单元拆分出来放在互联网上来提供“服务”，在某些地方也被称为**“分布式架构”**，由于出现的年代也比较久远，一般被看作一种“中型架构”，作为“单体架构的并行拓展”。

具体地说，**面向服务架构或者说分布式架构**，将一个大的系统划分为多个业务模块，业务模块分别部署在不同的服务器上，各个业务模块之间通过接口进行数据交互。数据库也大量采用分布式数据库。通过LVS/Nginx代理应用，将用户请求均衡的负载到不同的服务器上。

所谓服务（service），就是在后台不间断运行、提供某种功能的一个程序。最常见的服务就是 Web 服务，通过80端口向外界提供网页访问，所以我们常见的C/S架构其实也算一种面向服务架构（后端向前端提供某种“服务”）。

![img](https://raw.githubusercontent.com/gudaoxuri/Microservices-Architecture/master/resources/images/soa.png)

采用SOA架构有以下优点：

- 每种服务功能单一，相当于一个小型软件，便于开发和测试；
- 各个服务独立运行，可以单独开发和部署，可以使用不同的语言和工具开发；
- 鼓励和支持代码重用，同一个服务可以用于多种目的；
- 扩展性好，可以容易地加机器、加功能，承受高负载；
- **面向服务架构默认运行在不同服务器上**，每台服务器提供一种服务，多台服务器共同组成一个完整的网络应用，即使一个服务失败了，不会影响到其他服务。

#### 通信协议：SOAP和REST

既然服务是运行在Web上的，那么如何制定通信标准就是一个棘手且紧急的问题。

早期的SOA多以基于**SOAP (Simple Object Access Protocol)协议**的Webservice实现，因其通过WSDL (Web Service Description Language)实现了严格服务间通讯格式约束，所以它非常适用于对稳定性要求高、不易变、防御式的场景， 这种方式在当下的银行、电信系统中还有很大市场。但SOAP的优势也为其带来了：笨重、不灵活、修改困难、通讯效率低等问题。

我个人是搞前端的，入行的时候也已经REST大行其道了，因此这里也主推RESTful API规范。

> REST（Representational State Transfer, 代表性的状态迁移）是Roy Thomas Fielding博士于2000年在他的博士论文中提出来的一种互联网软件架构风格， 目的是便于不同软件/程序在网络中互相传递信息。 使用上看似简单，但背后有着深厚的理论支持。 [详见此处](https://en.wikipedia.org/wiki/Representational_state_transfer)
>
> HTTP是REST的一个主要表现协议，但REST本身是协议无关的。在实际开发中，我们可近似地认为REST就是用于HTTP的，使用HTTP的请求头操作字段，如GET/POST/MODIFY等。

REST的核心特征是**面向资源（Resource Oriented）、可寻址（Addressability）、连通性（Connectedness）、无状态（Statelessness）、统一接口（Uniform Interface）、超文本驱动（Hypertext Driven）**。

RESTful API 将所有服务抽象为资源，资源不仅代表服务器中的文件、数据库中的表等具体的东西，它可以是任何对象。 通过URL定位资源，使用 HTTP 方法（HTTP Method）确定对资源执行什么操作，通俗地说（严格而言有一定问题，见下文说明）所有操作都可以抽象为CRUD（Create-创建，Retrieve-查询，Update-更新，Delete-删除），可分别对应于HTTP的 POST、GET、PUT、DELETE。 由于使用标准的HTTP操作、没有Schema约束，REST成为系统间轻量交互的首选方式。

虽然REST的大道理很多，背后有很多理论支持，但我们使用它只需要遵循简单的规范，并不需要去证明高深的理论，就可以构造出简明易懂且灵活的API，这也是REST的魅力所在。

### 微服务架构

说了这么久终于说到主角了啊，介绍了SOA架构后理应就可以满足大部分需求了，为什么还要引入微服务架构呢？

SOA架构有以下缺点，在项目规模被进一步放大后其劣势将被凸显出来：

- **传统SOA拆分的粒度较大** 一般按业务域划分系统，但很少涉及系统内细粒度地拆分。传统SOA只解决了业务层面的划分和系统之间的交互，但**没能从架构层面解决系统内的复杂度**、效率、安全等单体架构所存在的问题
- **传统SOA多需要集中的服务总线，容易产生性能瓶颈** ESB（Enterprise service bus）几乎是传统SOA必备的，它集通信交互、服务编排、认证授权、质量监控等功能于一身，可十分方便地管理各个零散的系统。而一旦涉及总线，那性能瓶颈就一定会受木桶效应的影响，而这个短板在爆发式高并发场景下一般都是总线本身（学过组原的应该都有所体会）。



## 参考资料

- [微服务是什么？ - 阮一峰的网络日志 (ruanyifeng.com)](https://www.ruanyifeng.com/blog/2022/04/microservice.html)
- [Introduction - 微服务：从设计到部署 (gitbook.io)](https://docshome.gitbook.io/microservices/)
- [微服务架构设计 - 微服务架构设计 (gitbook.io)](https://gudaoxuri.gitbook.io/microservices-architecture/)
- [微服务 2.0 技术栈选型手册 (qq.com)](https://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247490615&idx=1&sn=1a8c7126bf46a3cf1add60119803f220#wechat_redirect)
- [微服务架构超强讲解，通俗易懂，写得太好了！ - 腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/news/841137)
- [微服务架构是什么？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/65502802)
- [什么叫做微服务？它和传统的项目之间有什么区别？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/55511712)
- [四种软件架构：单体架构、分布式架构、微服务架构、Serverless架构 | 戴树谦的博客 (crimsonromance.github.io)](https://crimsonromance.github.io/2019/03/23/四种软件架构：单体架构、分布式架构、微服务架构、Serverless架构/)



